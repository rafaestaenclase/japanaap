<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Práctica Hiragana</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    padding: 5px 10px;
    margin: 0;
    overflow-x: hidden;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  h1 {
    font-size: clamp(1.2rem, 5vw, 2rem);
    margin: 0;
  }
  .question {
    font-size: clamp(1.8rem, 8vw, 3rem);
    margin: 20px 0;
    transition: color 0.3s ease;
  }
  input {
    font-size: 1.5rem;
    padding: 8px;
    text-align: center;
    width: 100%;
    max-width: 300px;
    border: none;
    outline: none;
 	border: none; 
  }
  button {
    font-size: 1.2rem;
    padding: 8px 12px;
    cursor: pointer;
    border: none;
    background: none;
  }
  /* Vibración visual */
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    50% { transform: translateX(8px); }
    75% { transform: translateX(-8px); }
    100% { transform: translateX(0); }
  }
  /* Círculo de acierto */
  .correct-circle {
	font-size: clamp(4rem, 20vw, 10rem);
    color: green;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .correct-circle.show {
    opacity: 1;
  }
  /* Círculo de acierto con animación más vistosa */
.correct-circle {
  font-size: clamp(4rem, 20vw, 10rem);
  color: #4caf50; /* verde japonés */
  opacity: 0;
  pointer-events: none;
  transform: scale(0.7);
  filter: drop-shadow(0 0 5px #4caf50);
  transition: opacity 0.3s ease, transform 0.3s ease;
  position: relative;
  user-select: none;
  /* Para que las partículas puedan posicionarse */
  overflow: visible;
}

/* Cuando se muestra */
.correct-circle.show {
  opacity: 1;
  transform: scale(1);
  animation: glowPulse 0.8s ease forwards;
}

/* Pulso de brillo */
@keyframes glowPulse {
  0% {
    filter: drop-shadow(0 0 5px #4caf50);
  }
  50% {
    filter: drop-shadow(0 0 20px #a5d6a7);
  }
  100% {
    filter: drop-shadow(0 0 5px #4caf50);
  }
}

/* Partículas simples - 3 estrellitas */
.correct-circle::before,
.correct-circle::after,
.correct-circle span {
  content: "";
  position: absolute;
  width: 6px;
  height: 6px;
  background: #a5d6a7;
  border-radius: 50%;
  box-shadow: 0 0 8px #a5d6a7;
  opacity: 0;
  animation: sparkle 0.8s ease forwards;
  pointer-events: none;
}

.correct-circle::before {
  top: 10%;
  left: 15%;
  animation-delay: 0.1s;
}

.correct-circle::after {
  top: 25%;
  right: 15%;
  animation-delay: 0.3s;
}

.correct-circle span {
  bottom: 15%;
  left: 50%;
  transform: translateX(-50%);
  animation-delay: 0.5s;
}

/* Animación de destello */
@keyframes sparkle {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    opacity: 1;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(0.3);
  }
}


  /* Barra de progreso estilo píldoras */
#progressPills {
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  gap: 6px;
  margin: 15px auto 30px auto;
  max-width: 90vw;
  user-select: none;
}
.pill {
  position: relative;
  width: 18px;
  height: 18px;
  background: #ccc;
  border-radius: 9999px;
  overflow: hidden;
  cursor: default;
  box-shadow: none;
  transition: box-shadow 0.3s ease;
}

.pill-fill {
  position: absolute;
  top: 0; left: 0; bottom: 0;
  background: #4caf50; /* verde japonés */
  border-radius: 9999px 0 0 9999px;
  width: 0%;
  transition: width 0.3s ease;
}

.pill.filled .pill-fill {
  width: 100%;
  border-radius: 9999px;
  box-shadow: 0 0 8px #a5d6a7;
}

.pill.vibrate {
  animation: vibrate 0.6s linear;
}

@keyframes vibrate {
  0% { transform: translateX(0); }
  10% { transform: translateX(-4px); }
  20% { transform: translateX(4px); }
  30% { transform: translateX(-4px); }
  40% { transform: translateX(4px); }
  50% { transform: translateX(-4px); }
  60% { transform: translateX(4px); }
  70% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
  90% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}

/* Estrellitas animadas */
.pill .sparkle {
  position: absolute;
  background: #a5d6a7;
  border-radius: 50%;
  box-shadow: 0 0 8px #a5d6a7;
  width: 6px;
  height: 6px;
  opacity: 0;
  animation: sparkle 0.6s ease forwards;
  pointer-events: none;
}

.pill .sparkle:nth-child(1) {
  top: 5%;
  left: 10%;
  animation-delay: 0.1s;
}

.pill .sparkle:nth-child(2) {
  top: 20%;
  right: 15%;
  animation-delay: 0.3s;
}

.pill .sparkle:nth-child(3) {
  bottom: 15%;
  left: 50%;
  transform: translateX(-50%);
  animation-delay: 0.5s;
}

@keyframes sparkle {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    opacity: 1;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(0.3);
  }
}



</style>
</head>
<body>
  <header>
    <h1>Práctica Hiragana</h1>
    <button>Salir</button>
  </header>

  <div class="question" id="question"></div>
  <input id="answer" placeholder="Escribe en hiragana">
  <div id="feedback"></div>
  <div class="correct-circle" id="correctCircle">〇</div>
  <div id="progressPills"></div>
<script>
const hiraganaList = [
  // Vocales
  { romaji: "a", hiragana: "あ" },
  { romaji: "i", hiragana: "い" },
  { romaji: "u", hiragana: "う" },
  { romaji: "e", hiragana: "え" },
  { romaji: "o", hiragana: "お" },

  // K
  { romaji: "ka", hiragana: "か" },
  { romaji: "ki", hiragana: "き" },
  { romaji: "ku", hiragana: "く" },
  { romaji: "ke", hiragana: "け" },
  { romaji: "ko", hiragana: "こ" },

  // S
  { romaji: "sa", hiragana: "さ" },
  { romaji: "shi", hiragana: "し" },
  { romaji: "su", hiragana: "す" },
  { romaji: "se", hiragana: "せ" },
  { romaji: "so", hiragana: "そ" },

  // T
  { romaji: "ta", hiragana: "た" },
  { romaji: "chi", hiragana: "ち" },
  { romaji: "tsu", hiragana: "つ" },
  { romaji: "te", hiragana: "て" },
  { romaji: "to", hiragana: "と" },

  // N
  { romaji: "na", hiragana: "な" },
  { romaji: "ni", hiragana: "に" },
  { romaji: "nu", hiragana: "ぬ" },
  { romaji: "ne", hiragana: "ね" },
  { romaji: "no", hiragana: "の" },

  // H
  { romaji: "ha", hiragana: "は" },
  { romaji: "hi", hiragana: "ひ" },
  { romaji: "fu", hiragana: "ふ" },
  { romaji: "he", hiragana: "へ" },
  { romaji: "ho", hiragana: "ほ" },

  // M
  { romaji: "ma", hiragana: "ま" },
  { romaji: "mi", hiragana: "み" },
  { romaji: "mu", hiragana: "む" },
  { romaji: "me", hiragana: "め" },
  { romaji: "mo", hiragana: "も" },

  // Y
  { romaji: "ya", hiragana: "や" },
  { romaji: "yu", hiragana: "ゆ" },
  { romaji: "yo", hiragana: "よ" },

  // R
  { romaji: "ra", hiragana: "ら" },
  { romaji: "ri", hiragana: "り" },
  { romaji: "ru", hiragana: "る" },
  { romaji: "re", hiragana: "れ" },
  { romaji: "ro", hiragana: "ろ" },

  // W
  { romaji: "wa", hiragana: "わ" },
  { romaji: "wo", hiragana: "を" },

  // N final
  { romaji: "n", hiragana: "ん" },

  // Dakuon (G)
  { romaji: "ga", hiragana: "が" },
  { romaji: "gi", hiragana: "ぎ" },
  { romaji: "gu", hiragana: "ぐ" },
  { romaji: "ge", hiragana: "げ" },
  { romaji: "go", hiragana: "ご" },

  // Dakuon (Z)
  { romaji: "za", hiragana: "ざ" },
  { romaji: "ji", hiragana: "じ" },
  { romaji: "ji", hiragana: "ぢ", alt: true }, // variante
  { romaji: "zu", hiragana: "ず" },
  { romaji: "zu", hiragana: "づ", alt: true }, // variante
  { romaji: "ze", hiragana: "ぜ" },
  { romaji: "zo", hiragana: "ぞ" },

  // Dakuon (D)
  { romaji: "da", hiragana: "だ" },
  { romaji: "de", hiragana: "で" },
  { romaji: "do", hiragana: "ど" },

  // Dakuon (B)
  { romaji: "ba", hiragana: "ば" },
  { romaji: "bi", hiragana: "び" },
  { romaji: "bu", hiragana: "ぶ" },
  { romaji: "be", hiragana: "べ" },
  { romaji: "bo", hiragana: "ぼ" },

  // Handakuten (P)
  { romaji: "pa", hiragana: "ぱ" },
  { romaji: "pi", hiragana: "ぴ" },
  { romaji: "pu", hiragana: "ぷ" },
  { romaji: "pe", hiragana: "ぺ" },
  { romaji: "po", hiragana: "ぽ" },

  // Yōon (K)
  { romaji: "kya", hiragana: "きゃ" },
  { romaji: "kyu", hiragana: "きゅ" },
  { romaji: "kyo", hiragana: "きょ" },

  // Yōon (S)
  { romaji: "sha", hiragana: "しゃ" },
  { romaji: "shu", hiragana: "しゅ" },
  { romaji: "sho", hiragana: "しょ" },

  // Yōon (T)
  { romaji: "cha", hiragana: "ちゃ" },
  { romaji: "chu", hiragana: "ちゅ" },
  { romaji: "cho", hiragana: "ちょ" },

  // Yōon (N)
  { romaji: "nya", hiragana: "にゃ" },
  { romaji: "nyu", hiragana: "にゅ" },
  { romaji: "nyo", hiragana: "にょ" },

  // Yōon (H/B/P)
  { romaji: "hya", hiragana: "ひゃ" },
  { romaji: "hyu", hiragana: "ひゅ" },
  { romaji: "hyo", hiragana: "ひょ" },
  { romaji: "bya", hiragana: "びゃ" },
  { romaji: "byu", hiragana: "びゅ" },
  { romaji: "byo", hiragana: "びょ" },
  { romaji: "pya", hiragana: "ぴゃ" },
  { romaji: "pyu", hiragana: "ぴゅ" },
  { romaji: "pyo", hiragana: "ぴょ" },

  // Yōon (M)
  { romaji: "mya", hiragana: "みゃ" },
  { romaji: "myu", hiragana: "みゅ" },
  { romaji: "myo", hiragana: "みょ" },

  // Yōon (R)
  { romaji: "rya", hiragana: "りゃ" },
  { romaji: "ryu", hiragana: "りゅ" },
  { romaji: "ryo", hiragana: "りょ" },

  // Yōon (G)
  { romaji: "gya", hiragana: "ぎゃ" },
  { romaji: "gyu", hiragana: "ぎゅ" },
  { romaji: "gyo", hiragana: "ぎょ" },

  // Yōon (J)
  { romaji: "ja", hiragana: "じゃ" },
  { romaji: "ja", hiragana: "ぢゃ", alt: true }, // variante
  { romaji: "ju", hiragana: "じゅ" },
  { romaji: "ju", hiragana: "ぢゅ", alt: true }, // variante
  { romaji: "jo", hiragana: "じょ" },
  { romaji: "jo", hiragana: "ぢょ", alt: true } // variante
];


// Mezclar aleatoriamente
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
shuffle(hiraganaList);

let index = 0;
const questionEl = document.getElementById("question");
const answerEl = document.getElementById("answer");
const correctCircle = document.getElementById("correctCircle");

// Sonido de acierto estilo japonés
const correctSound = new Audio("https://www.soundjay.com/buttons/sounds/button-3.mp3"); // "ピンポン"
const incorrectSound = new Audio("https://www.soundjay.com/buttons/sounds/button-44.mp3");
const pillCompleteSound = new Audio("https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3");

let checkTimeout;

// Mostrar pregunta
function showQuestion() {
  questionEl.textContent = hiraganaList[index].romaji;
  questionEl.style.color = "";
  answerEl.value = "";
}

// Pasar a la siguiente pregunta
function nextQuestion() {
  index++;
  updatePills(index);

  if(index < hiraganaList.length) {
    showQuestion();
  } else {
    questionEl.textContent = "¡Completado!";
    answerEl.style.display = "none";
  }
}


let isChecking = false; // bloqueo para evitar entradas durante animación

answerEl.addEventListener("input", () => {
  if (isChecking) return; // ignorar entradas mientras está bloqueado

  clearTimeout(checkTimeout); // cancelar temporizador anterior
  const userAnswer = answerEl.value.trim();

  if (userAnswer.length === 0) return;

  if (userAnswer.normalize('NFC') === hiraganaList[index].hiragana.normalize('NFC')) {
    isChecking = true; // bloquear entradas mientras anima y cambia pregunta
    showCorrect();
    return;
  }

  checkTimeout = setTimeout(() => {
    if (answerEl.value.trim().normalize('NFC') !== hiraganaList[index].hiragana.normalize('NFC')) {
      showIncorrect();
      answerEl.value = "";
    }
  }, 3000);
});

// Animación correcto
function showCorrect() {
  questionEl.style.color = "green";
  correctCircle.classList.add("show");

  const sparkleSpan = document.createElement('span');
  correctCircle.appendChild(sparkleSpan);

  correctSound.currentTime = 0;
  correctSound.play();

  setTimeout(() => {
    correctCircle.classList.remove("show");
    correctCircle.removeChild(sparkleSpan);
    questionEl.style.color = "";
    nextQuestion();
    isChecking = false; // desbloquear para que el usuario pueda escribir la siguiente respuesta
  }, 800);
}

// Animación incorrecto
function showIncorrect() {
  questionEl.style.color = "red";
  questionEl.style.animation = "shake 0.3s";

  incorrectSound.currentTime = 0;
  incorrectSound.play();

  if (navigator.vibrate) navigator.vibrate(200);
  setTimeout(() => {
    questionEl.style.color = "";
    questionEl.style.animation = "";
  }, 400);
}


showQuestion();

// Mantener foco en el input
function keepFocus() {
  answerEl.focus();
}
answerEl.addEventListener("blur", () => {
  setTimeout(keepFocus, 0);
});
keepFocus();


//PILDORAS
const maxPillsVisible = 20; // máximo píldoras en pantalla
const totalItems = hiraganaList.length;

// Calculamos el tamaño del bloque que representa cada píldora:
const blockSize = Math.ceil(totalItems / maxPillsVisible);

// Calculamos cuántas píldoras realmente pondremos (<= maxPillsVisible)
const totalPills = Math.ceil(totalItems / blockSize);

const progressPills = document.getElementById("progressPills");

// Limpiamos por si acaso
progressPills.innerHTML = "";

// Crear píldoras con relleno interno
for(let i = 0; i < totalPills; i++) {
  const pill = document.createElement("div");
  pill.classList.add("pill");

  const pillFill = document.createElement("div");
  pillFill.classList.add("pill-fill");

  pill.appendChild(pillFill);
  progressPills.appendChild(pill);
}

// Animación y vibración al completar una píldora
function animatePillCompletion(pill) {
  if (navigator.vibrate) navigator.vibrate(300);

  // Añadir clase vibrar y quitarla tras animación para que se note el movimiento
  pill.classList.add("vibrate");
  setTimeout(() => {
    pill.classList.remove("vibrate");
  }, 600); // duración igual que la animación CSS

  // Sonido al completar píldora
  pillCompleteSound.currentTime = 0;
  pillCompleteSound.play();

  // Crear partículas (estrellitas)
  for(let i=0; i<5; i++) {
    const star = document.createElement("span");
    star.className = "star";
    star.style.position = "absolute";
    star.style.width = "6px";
    star.style.height = "6px";
    star.style.background = "#a5d6a7";
    star.style.borderRadius = "50%";
    star.style.filter = "drop-shadow(0 0 5px #a5d6a7)";
    star.style.pointerEvents = "none";

    // Posición random cerca de la píldora
    const angle = Math.random() * 2 * Math.PI;
    const radius = 20 + Math.random() * 10;
    star.style.left = (pill.offsetLeft + pill.offsetWidth/2 + Math.cos(angle)*radius) + "px";
    star.style.top = (pill.offsetTop + pill.offsetHeight/2 + Math.sin(angle)*radius) + "px";

    document.body.appendChild(star);

    // Animación simple: crecer y desaparecer (1 segundo)
    star.animate([
      {opacity: 1, transform: "scale(1) translateY(0)"},
      {opacity: 0, transform: "scale(0) translateY(-15px)"}
    ], {duration: 1000, easing: "ease-out"});

    // Eliminar después de la animación
    setTimeout(() => star.remove(), 1000);
  }
}

// Función para actualizar el estado visual de las píldoras
function updatePills(currentIndex) {
  const pills = progressPills.children;

  const pillIndex = Math.floor(currentIndex / blockSize);
  const inBlockProgress = (currentIndex % blockSize) / blockSize;

  for(let i = 0; i < pills.length; i++) {
    const pill = pills[i];
    const fill = pill.querySelector(".pill-fill");

    if(i < pillIndex) {
      fill.style.width = "100%";
      pill.classList.add("filled");
    } else if(i === pillIndex) {
      fill.style.width = (inBlockProgress * 100) + "%";
      pill.classList.remove("filled");
    } else {
      fill.style.width = "0%";
      pill.classList.remove("filled");
    }
  }

  // Si la píldora acaba de llenarse (cuando el progreso es 1)
  if ((currentIndex % blockSize) === 0 && currentIndex !== 0) {
    const completedPill = pills[pillIndex - 1];
    if(completedPill) {
      animatePillCompletion(completedPill);
    }
  }
}



</script>

</body>
</html>
