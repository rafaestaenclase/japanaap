<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<title>Práctica</title>
<link rel="stylesheet" href="css/styles.css" />
<style>
  #pageTitle {
    margin: 0;
    padding: 8px 12px;
  }

  #pageTitle .subsection {
    font-weight: normal;
    font-size: 0.7em;
    color: #555;
  }
</style>
</head>
<body>
  <header>
    <h1 id="pageTitle">Examen</h1>
    <button id="exitBtn">Salir</button>
  </header>

  <div class="question" id="question"></div>
  <input id="answer" placeholder="Escribe en japonés" autocomplete="off" autofocus />
  <div id="feedback"></div>
  <div class="correct-circle" id="correctCircle">〇</div>
  <div id="progressPills"></div>
  <button id="showAnswerBtn">Ver respuesta</button>

  <script>
    document.getElementById("exitBtn").addEventListener("click", () => {
      window.location.href = "index.html";
    });

    // Focus en input al pulsar cualquier parte de la pantalla
    const answerInput = document.getElementById("answer");
    document.body.addEventListener("click", (e) => {
      if (e.target !== answerInput && e.target.id !== "startWritingBtn") {
        answerInput.focus();
      }
    });
  </script>

  <script src="js/hiraganaList.js"></script>
  <script src="js/katakanaList.js"></script>
  <script src="js/vocabularyBasicList.js"></script>

<script>
  const params = new URLSearchParams(window.location.search);
  const play = params.get("exam"); // ej: "hiraganaList-5,katakanaList-2"

  let filteredQuizList = [];
  let section = "";
  let subSectionNames = [];

  // --- función para repartir preguntas de forma equilibrada ---
  function seleccionarPreguntas(listasSeleccionadas) {
    const maxPreguntas = 10;
    const totalListas = listasSeleccionadas.length;

    if (totalListas === 0) return [];

    // reparto base
    let base = Math.floor(maxPreguntas / totalListas);
    let resto = maxPreguntas % totalListas;

    let preguntasFinales = [];

    listasSeleccionadas.forEach((lista, i) => {
      let cantidad = base + (i < resto ? 1 : 0); // reparte sobrante
      // si la lista tiene menos elementos que cantidad, cogemos los que haya
      let seleccionadas = lista.sort(() => 0.5 - Math.random()).slice(0, cantidad);
      preguntasFinales.push(...seleccionadas);
    });

    return preguntasFinales;
  }

  if (play) {
    const selections = play.split(",");

    // aquí guardaremos las sublistas antes de combinarlas
    let subLists = [];

    selections.forEach(sel => {
      const [listName, levelStr] = sel.split("-");
      const level = parseInt(levelStr);

      let currentList;
      if (listName === "hiraganaList") {
        currentList = hiraganaList;
      } else if (listName === "katakanaList") {
        currentList = katakanaList;
      } else if (listName === "vocabularyBasicList") {
        currentList = vocabularyBasicList;
      } else {
        console.error("Tipo de lista no válido:", listName);
        return;
      }

      if (!section) section = currentList.category;

      const levelData = currentList.levels.find(l => l.level === level);
      if (levelData) {
        const markedItems = levelData.items.map(it => ({
          ...it,
          origin: currentList.category,
          sublevel: levelData.name
        }));
        subLists.push(markedItems); // guardamos la sublista completa
        subSectionNames.push(`${currentList.category}: ${levelData.name}`);
      } else {
        console.error(`Nivel ${level} no encontrado en ${listName}`);
      }
    });

    // aquí aplicamos la selección equilibrada
    filteredQuizList = seleccionarPreguntas(subLists);
  } else {
    console.error("No se ha especificado un examen válido");
  }

  // barajar resultado final
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }
  shuffle(filteredQuizList);

  // mostrar título
  document.getElementById("pageTitle").innerHTML = `
    Examen <span class="subsection">[${subSectionNames.join(", ")}]</span>
  `;
</script>


  <script src="js/quizLogic.js"></script>
</body>
</html>
