<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<title>Practicar Japon√©s</title>
<style>

  * {
  outline: none;          /* Quita el borde de foco azul */
  user-select: none;      /* Opcional: evita selecci√≥n de texto al hacer click */
  -webkit-tap-highlight-color: transparent; /* Quita el highlight en m√≥viles */
  }

  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
  }

  #studyDiv {
    position: fixed;
    height: calc(25vh - 21px);
    width: calc(100% - 65px);
    background: #fefff3;
    top: 0;
    left: 0;
    z-index: 100;
    overflow: scroll;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    flex-wrap: nowrap;
    padding: 10px;
  }

   #studyDiv * {
    font-size: 20px;
   }

  #sectionsContainer {
    width: calc(100% - 44px);
    max-width: 960px;
    height: calc(75vh - 120px);
    margin-top: 25vh;
    overflow: scroll;
    padding-bottom: 120px;
  }

  .section {
    width: calc(100% - 30px);
    margin-bottom: 2px;
    padding: 15px;
    background: white;
  }
  .section-title {
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 10px;
    color: #2c3e50;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .level-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(32%, 1fr));
    gap: 3px;
    justify-items: center;
    align-items: center;
  }
  .level-card {
    width: calc(100% - 30px);
    height: 60px;
    padding: 15px;
    background: #fefefe;
    display: grid;
    place-items: center;
    box-shadow: 0 3px 10px rgb(196 192 180 / 52%);
    transition: .2s;
    font-size: 14px;
    color: #000;
    text-align: center;
    cursor: pointer;
    justify-content: center;
    justify-items: center;
  }

  button {
    touch-action: manipulation;  /* mejora el touch en m√≥viles */
    -webkit-user-select: none;   /* evitar selecci√≥n en iOS */
    user-select: none;
    outline: none;
  }

  .level-card.selected { background: #0a0862; color: #fff; transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,.12);}
  #fixedPlayButton {
    height: 48px;
    padding: 0 15px;
    font-weight: 600;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    background: none;
    color: white;
  }

  #examToggleButton { 
    width: 100%;
    max-height: 25vh;
    font-weight: 600;
    border: none;
    color: white;
    background: #086242;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    writing-mode: vertical-rl;
    text-orientation: upright;
    padding: 15px 0px;
    margin-top: 5px;
  }

  #examToggleButton.active { border: 3px solid #cc2e2e; box-shadow: 0 3px 10px rgba(0,0,0,.15); }
  #completedTimes { font-size: 12px; color: #2c3e50; font-weight: 500; }
  #completedTimes.instruction { color: #7f8c8d; font-style: italic; }
  #practiceContainer {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: #0a0862; padding: 10px 15px;
    box-shadow: 0 5px 19px 1px rgba(0,0,0,.28); display: flex; gap: 10px;
    z-index: 100; justify-content: space-between; display: none; justify-content: center;
  }
  .examButton {
    background: #ecf0f1; border: none; padding: 4px 8px;
    border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: background .2s;
  }
  .examButton:hover { background: #d0d7de; }

  #verticalBar {
    position: fixed;
    height: 100vh;
    width: 44px;
    top: 0;
    right: 0;
    background: #fefff3;
    border-radius: 12px;
    box-shadow: 0 5px 19px 1px rgba(0, 0, 0, .28);
    display: flex;
    z-index: 101;
    justify-content: center;
    flex-wrap: wrap;
    align-content: flex-start;
  }

  #webTitle {
    font-size: 2vh;
    height: 25vh;
    width: 100%;
    background: #620808;
    color: #ebebeb;
    display: flex;
    align-items: center;
    justify-content: center;
    writing-mode: vertical-rl; /* texto vertical */
    text-orientation: upright; /* cada car√°cter en pie */
    font-weight: bold;
  }

  .categoryButton {
    height: 40px;
    width: 40px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    border: none;
    background: #17171712;
    border: solid 1px gray;
    border-radius: 69px;
    margin-top: 5px;
    text-shadow:
      -4px -4px 8px white,
       4px -4px 8px white,
      -4px  4px 8px white,
       4px  4px 8px white;
  }

  #fullscreenToggle {
    height: 40px;
    width: 40px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    border: none;
    margin-top: 5px;
  }

  #categoryMenu {
    display: flex;
    max-height: 40vh;
    align-content: flex-start;
    flex-wrap: wrap;
    justify-content: center;
  }

  .level-card h3 { margin:0; font-size:14px; }
  .level-card p { margin:0; font-size:12px; color:#7f8c8d; }
</style>
</head>
<body>
  <div id="verticalBar">
    <div id="webTitle">„Ç∏„É£„Éë„É≥„Ç¢„ÉÉ„Éó</div>
    <div id="categoryMenu"></div>
    <button id="examToggleButton">EXAMEN</button>
    <button id="fullscreenToggle">‚õ∂</button>
  </div>

<div id="studyDiv"></div>

<div id="sectionsContainer"></div>
<div id="practiceContainer">
  <button id="fixedPlayButton">Practicar</button>
</div>

<!--A√±adir lista-->
<script src="./js/hiraganaList.js"></script>
<script src="./js/katakanaList.js"></script>
<script src="./js/vocabularyBasicList.js"></script>
<script src="./js/particleList.js"></script>
<script src="./js/verbConjugationList.js"></script>
<script src="./js/demonstrativesList.js"></script>
<script src="./js/numbersList.js"></script>

<script>
  //A√±adir lista
  const allList = [hiraganaList, katakanaList, vocabularyBasicList, particleList, verbConjugationList, demonstrativesList, numbersList];
  const container = document.getElementById("sectionsContainer");
  const categoryMenu = document.getElementById("categoryMenu");
  const fixedBtn = document.getElementById("fixedPlayButton");
  const examBtn = document.getElementById("examToggleButton");
  const times = document.getElementById("completedTimes");

  let selected = null, examMode = false, examSel = [];

  // Crear grid para un nivel
  function createGrid(listObj, parent) {
    const section = document.createElement("div");
    section.id = listObj.listName;
    section.classList.add("section", listObj.category);

    const title = document.createElement("div");
    title.className = "section-title";
    title.textContent = listObj.listName;
    section.appendChild(title);

    const grid = document.createElement("div");
    grid.className = "level-grid";

    listObj.levels.forEach((lvl, i) => {
      const levelCard = document.createElement("div");
      levelCard.className = "level-card";
      levelCard.dataset.listName = listObj.listName;
      levelCard.dataset.level = lvl.level;
      levelCard.dataset.index = i;
      levelCard.innerHTML = `<h3>${lvl.name}</h3>`;
      levelCard.onclick = () => handleCardClick(levelCard);
      grid.appendChild(levelCard);
    });

    section.appendChild(grid);
    parent.appendChild(section);
  }

  // Crear las categor√≠as din√°micamente
  const categories = [...new Set(allList.map(l => l.category))];
  categories.forEach(cat => {
    const categoryDiv = document.createElement("div");
    categoryDiv.className = "category-block";
    categoryDiv.dataset.category = cat;

    // T√≠tulo de categor√≠a con emoji
    const h2 = document.createElement("h2");
    h2.style.padding = "5px";
    h2.style.background = "#ecf0f1";
    h2.style.margin = "0 0 10px 0";
    h2.style.color = "#2c3e50";
    h2.textContent =
      cat === "write" ? "‚úçÔ∏è Escritura" :
      cat === "vocabulary" ? "üìñ Vocabulario" :
      cat === "grammar" ? "üß© Gram√°tica" :
      cat; // fallback

    categoryDiv.appendChild(h2);

    // A√±adir todas las secciones de esta categor√≠a
    allList.filter(l => l.category === cat).forEach(listObj => {
      createGrid(listObj, categoryDiv);
    });

    container.appendChild(categoryDiv);
  });

  // Resto de tu c√≥digo (NO TOCADO) ‚Üì‚Üì‚Üì
  // Manejo de click en tarjetas
  function handleCardClick(card) {
    const practiceContainer = document.getElementById("practiceContainer");
    const studyDiv = document.getElementById("studyDiv");

    let currentList = allList.find(l => l.listName === card.dataset.listName);
    let currentLevel = currentList.levels[card.dataset.index];

    if (examMode) {
      card.classList.toggle("selected");
      examSel = card.classList.contains("selected")
        ? [...examSel, card]
        : examSel.filter(x => x !== card);

      fixedBtn.classList.toggle("active", examSel.length > 0);
      practiceContainer.style.display = examSel.length > 0 ? "flex" : "none";
    } else {
      if (selected === card) {
        card.classList.remove("selected");
        selected = null;
        fixedBtn.classList.remove("active");
        studyDiv.innerHTML = "";
      } else {
        if (selected) selected.classList.remove("selected");
        card.classList.add("selected");
        selected = card;
        fixedBtn.classList.add("active");

        // Mostrar informaci√≥n en studyDiv
        renderStudyDiv(currentLevel);
      }

      practiceContainer.style.display = selected ? "flex" : "none";
    }
  }

  function fitTextInStudyDiv() {
    const studyDiv = document.getElementById("studyDiv");
    if (!studyDiv) return;

    const children = Array.from(studyDiv.children);

    children.forEach(child => {
      let fontSize = parseInt(window.getComputedStyle(child).fontSize);

      // Reducir fuente hasta que el contenido quepa en ancho
      while (child.scrollWidth > studyDiv.clientWidth && fontSize > 8) {
        fontSize -= 1;
        child.style.fontSize = fontSize + "px";
        // Si tiene elementos internos tambi√©n ajustarlos
        child.querySelectorAll("*").forEach(el => el.style.fontSize = fontSize + "px");
      }
    });
  }


  // Aplicar al renderizar contenido
  function renderStudyDiv(level) {
    const studyDiv = document.getElementById("studyDiv");
    studyDiv.innerHTML = ""; // limpiar contenido previo

    const title = document.createElement("p");
    title.textContent = level.name;
    title.style.paddingLeft = "10px";
    title.style.marginBottom = "10px";
    title.style.fontWeight = "bold";
    title.style.color = "#2c3e50";
    title.style.fontSize = "1.2rem";
    studyDiv.appendChild(title);

    // Crear tabla
    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.width = "100%";

    // Cabecera
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    ["Espa√±ol", "Japon√©s"].forEach(text => {
      const th = document.createElement("th");
      th.textContent = text;
      th.style.border = "1px solid #ccc";
      th.style.padding = "8px";
      th.style.textAlign = "left";
      th.style.background = "#f0f0f0";
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Cuerpo
    const tbody = document.createElement("tbody");
    level.items.forEach(item => {
      const tr = document.createElement("tr");

      const td1 = document.createElement("td");
      td1.textContent = item.q;
      td1.style.border = "1px solid #ccc";
      td1.style.padding = "8px";

      const td2 = document.createElement("td");
      td2.textContent = item.a;
      td2.style.border = "1px solid #ccc";
      td2.style.padding = "8px";
      td2.style.fontWeight = "bold";

      tr.appendChild(td1);
      tr.appendChild(td2);
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    studyDiv.appendChild(table);

    fitTextInStudyDiv(); // ajustar tama√±o de fuente
  }


  // Bot√≥n examen
  examBtn.onclick = () => {
    studyDiv.innerHTML = "";
    examMode = !examMode;
    examBtn.classList.toggle("active", examMode);
    fixedBtn.textContent = examMode ? "Comenzar" : "Practicar";
    examBtn.textContent = examMode ? "CANCELAR" : "EXAMEN";
    studyDiv.innerHTML = examMode ? '<h3 style="padding-left: 10px;" >SELECCIONA LOS M√ìDULOS A A√ëADIR AL EXAMEN.</h3>' : "";
    if (examMode) {
      if (selected) {
        selected.classList.remove("selected");
        selected = null;
        fixedBtn.classList.remove("active");
      }
    } else {
      examSel.forEach(c => c.classList.remove("selected"));
      examSel = [];
      fixedBtn.classList.remove("active");
    }
  };

  // Bot√≥n practicar/comenzar
  fixedBtn.onclick = () => {
    if (examMode && examSel.length) {
      location.href = `practiceGround.html?exam=${examSel.map(c => `${c.dataset.listName}List-${c.dataset.level}`).join(",")}`;
    } else if (!examMode && selected) {
      location.href = `practiceGround.html?play=${selected.dataset.listName}List&level=${selected.dataset.level}`;
    }
  };

// Llenar categoryMenu con botones √∫nicos
const uniqueCategories = [...new Set(allList.map(l => l.category))];
uniqueCategories.forEach(cat => {
  const btn = document.createElement("button");
  switch (cat) {
    case "write":
      btn.textContent = "‚úèÔ∏è";
      break;
    case "vocabulary":
      btn.textContent = "üìñ";
      break;
    case "grammar":
      btn.textContent = "üß©";
      break;
    default:
      btn.textContent = "?"; // opcional, por si no coincide nada
      break;
  }
  btn.id = cat;
  btn.className = "categoryButton";
  btn.onclick = () => {
    const sectionSelected = container.querySelector(`.section.${cat}`);
    if (!sectionSelected) return;
    const offset = window.innerHeight * 0.25 + 70;
    const y = Math.max(0, sectionSelected.offsetTop - offset);
    container.scrollTo({ top: y, behavior: 'smooth' });
  };
  categoryMenu.appendChild(btn);
});


  // Bot√≥n de pantalla completa
  const fullscreenBtn = document.getElementById("fullscreenToggle");

  fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        alert(`Error al intentar entrar en pantalla completa: ${err.message}`);
      });
    } else {
      document.exitFullscreen();
    }
  };


  window.addEventListener("beforeunload", () =>
    localStorage.setItem("lastScrollPosition", container.scrollTop)
  );
  window.addEventListener("load", () =>
    container.scrollTo(0, Number(localStorage.getItem("lastScrollPosition") || 0))
  );


  function showGanbatte() {
    const studyDiv = document.getElementById("studyDiv");
    if (studyDiv.innerHTML.trim() === "") {
      studyDiv.innerHTML = "<h1 style='font-weight:bold;padding-left:10px;margin-bottom:0px'>„Åå„Çì„Å∞„Å£„Å¶</h1><h3 style='font-weight:bold;padding-left:10px;margin-top:0px'>√Ånimo</h3>";
    }
  }

  // Al arrancar
  showGanbatte();

    // 2. Observador para detectar cambios posteriores
  const observer = new MutationObserver(() => {
    showGanbatte();
  });

  observer.observe(studyDiv, {
    childList: true,
    subtree: true
  });



function fitTextInCard(card) {
  const h3 = card.querySelector("h3");
  if (!h3) return;

  let fontSize = 14; // tama√±o inicial en px
  h3.style.fontSize = fontSize + "px";

  // Reducir tama√±o hasta que quepa
  while (h3.scrollWidth > card.clientWidth - 15 && fontSize > 8) {
    fontSize -= 1;
    h3.style.fontSize = fontSize + "px";
  }
}

// Aplicarlo a todos los level-card
document.querySelectorAll(".level-card").forEach(card => {
  fitTextInCard(card);
  // Opcional: si el texto cambia din√°micamente
  const observer = new MutationObserver(() => fitTextInCard(card));
  observer.observe(card, { childList: true, subtree: true });
});



// Evitar que el teclado aparezca en los campos de entrada
document.addEventListener('focusin', (event) => {
    // Si el elemento que recibe el foco es un campo de entrada (input, textarea, etc.)
    // le quitamos el foco inmediatamente.
    if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
        event.target.blur();
    }
});


</script>

</body>
</html>
