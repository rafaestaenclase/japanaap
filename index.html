<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<title>Practicar Japon√©s</title>
<style>
/* 1. Reset & Accesibilidad */
* {
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
  font-size: 15px;
  color: #E8E8E8;
  outline: none;
  user-select: none;
}

/* Ocultar scrollbar de todos los elementos scrollables */
#studyDiv::-webkit-scrollbar,
#sectionsContainer::-webkit-scrollbar {
  display: none; /* Chrome, Edge, Safari */
}

#studyDiv,
#sectionsContainer {
  -ms-overflow-style: none;  /* IE y Edge */
  scrollbar-width: none;     /* Firefox */
  overflow: auto; /* mantener scroll funcional */
}

body {
  font-family: "Noto Sans JP", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-optical-sizing: auto;
  font-weight: 400;
  margin: 0;
  padding: 0;
  background: #0B0B0E;
  line-height: 1.55;
}

button {
  touch-action: manipulation;
  cursor: pointer;
  border: none;
  background: none;
  transition: 0.2s;
}

/* Layout principal */
#studyDiv {
  position: fixed;
  top: 0;
  left: 0;
  height: 75vh;
  width: 50%;
  z-index: 1;
  overflow: auto;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  padding: 8px;
}

#studyDiv .title {
  font-size: 1.2rem;
  margin: 0 0 8px 10px;
  font-weight: 600;
}

#sectionsContainer {
  position: fixed;
  width: 50%;
  top: 0;
  bottom: 0;
  right: 0;
  overflow: auto;
  padding-top: 30vh;
}

/* Secciones */
.section {
  width: 100%;
  border-radius: 6px;
  padding: 4px 8px;
  position: relative;
}

/* Grid de niveles */
.level-grid {
  display: block;
  height: 0;
  overflow: hidden;
  opacity: 0;
  transform: translateY(-6px);
  transition: height 350ms cubic-bezier(.4,0,.2,1), opacity 260ms ease, transform 320ms cubic-bezier(.4,0,.2,1);
  margin-top: 8px;
  padding-left: 28px;
  position: relative;
}

.level-grid.expanded {
  display: flex;
  flex-direction: column;
  gap: 8px;
  height: auto; /* JS ajusta scrollHeight */
  opacity: 1;
  transform: translateY(0);
}

.level-grid.expanded::before {
  content: "";
  position: absolute;
  left: 5px;
  top: 0;
  bottom: 12px;
  width: 2px;
  background: #5c5c5c;
  border-radius: 2px;
  opacity: 0.8;
}

/* Tarjetas */
.level-card {
  padding: 10px 8px;
  margin-left: 0;
  border-radius: 6px;
  text-align: left;
  font-size: 0.95rem;
  position: relative;
  cursor: pointer;
  transition: all 0.18s;
  width: calc(100% - 28px);
  background: rgba(255, 255, 255, 0.02);
}

.level-card::before {
  content: "";
  position: absolute;
  left: -15px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 2px;
  background: #6d6d6d;
  border-radius: 2px;
  opacity: 0.9;
}

.level-card.selected {
  background: rgba(255, 255, 255, 0.10);
  box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.12);
  border-left: 3px solid #888;
}

.level-card h3 {
  margin: 0;
  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.3px;
}

/* Secci√≥n t√≠tulo */
.section-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  text-decoration: underline;
  text-underline-offset: 6px;
  font-weight: 600;
  letter-spacing: 0.4px;
}

.section-title span.arrow {
  display: inline-block;
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 7px solid #E6E6E6;
  transition: transform 300ms ease;
}

.section-title.expanded span.arrow {
  transform: rotate(180deg);
}

/* Tabla */
.study-table {
  width: 100%;
  margin-top: 4px;
  border-collapse: collapse;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 8px;
  overflow: hidden;
}

.study-table th, .study-table td {
  border: 1px solid #3a3a3a;
  padding: 8px;
  text-align: left;
}

.study-table th {
  background: rgba(255, 255, 255, 0.08);
  font-weight: 600;
}

.study-table td:last-child {
  font-weight: 500;
}

#actionDiv {
  position: fixed;
  padding-top: 8px;
  bottom: 0;
  left: 0;
  width: 50%;
  height: calc(25vh - 8px);
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-content: center;
  flex-direction: column;
  z-index: 10;
}

#actionDiv > * {
  margin: 0;
  width: 90%;
  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.3px;
  background: rgba(255, 255, 255, 0.10);
  border-radius: 6px;
  padding: 5px;
  text-align: center;
}

</style>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="studyDiv"></div>
  <div id="actionDiv">
    <div id="practiceButton">Practicar</div>
    <div>A√±adir a favoritos</div>
    <div>Ver solo favoritos</div>
  </div>
  <div id="sectionsContainer"></div>
<script src="./js/allLists.js"></script>
<script>
const $ = id => document.getElementById(id);
const ALL_LISTS = Object.values(window).filter(l => l?.levels && l.name);

const container = $("sectionsContainer");
const studyDiv = $("studyDiv");
let selected = null;
let currentCategory = null;

function createGrid(listObj, parent) {
  const section = document.createElement("div");
  section.id = listObj.listName || listObj.name.replace(/\s+/g,'_');
  section.className = `section ${listObj.category||''}`;

  const title = document.createElement("div");
  title.className = "section-title";
  title.textContent = listObj.name || "Sin nombre";
  const grid = document.createElement("div");
  grid.className = "level-grid";

  (listObj.levels||[]).forEach((lvl, i) => {
    const levelCard = document.createElement("div");
    levelCard.className = "level-card";
    levelCard.dataset.listName = listObj.listName || listObj.name;
    levelCard.dataset.index = i;
    const h = document.createElement('h3');
    h.textContent = lvl.name || `Nivel ${i+1}`;
    levelCard.appendChild(h);
    levelCard.onclick = () => handleCardClick(levelCard);
    grid.appendChild(levelCard);
  });

  title.onclick = () => {
    const expanded = grid.classList.toggle("expanded");
    grid.style.height = expanded ? grid.scrollHeight + "px" : "0px";
  };

  section.append(title, grid);
  parent.appendChild(section);
}

function initSectionsOnly() {
  const categories = [...new Set(ALL_LISTS.map(l => l.category||'default'))];
  categories.forEach(cat => {
    const catDiv = document.createElement("div");
    catDiv.className = "category-block";
    catDiv.dataset.category = cat;

    const h2 = document.createElement("h2");
    h2.textContent = cat === "write" ? "‚úçÔ∏è Escritura" :
                     cat === "vocabulary" ? "üìñ Vocabulario" :
                     cat === "grammar" ? "üß© Gram√°tica" : cat;
    catDiv.appendChild(h2);

    ALL_LISTS.filter(l => (l.category||'default')===cat).forEach(l => createGrid(l, catDiv));
    container.appendChild(catDiv);
  });
}

function handleCardClick(card){
  const deselect = selected===card;
  if(selected) selected.classList.remove("selected");
  if(deselect){ selected=null; studyDiv.innerHTML=""; showGanbatte(); return;}
  card.classList.add("selected"); selected=card;

  const lvl = ALL_LISTS.find(l=>l.listName===card.dataset.listName||l.name===card.dataset.listName)
             ?.levels[card.dataset.index];
  renderStudyDiv(lvl);
}

function renderStudyDiv(level){
  studyDiv.innerHTML="";
  if(!level){ studyDiv.innerHTML="<p class='title'>Nivel no encontrado</p>"; return; }

  const title = document.createElement("p");
  title.className="title"; title.textContent=level.name||"Nivel";
  studyDiv.appendChild(title);

  const table=document.createElement("table"); table.className="study-table";
  const thead=document.createElement("thead");
  const headerRow=document.createElement("tr");
  ["Espa√±ol","Japon√©s"].forEach(t=>{ const th=document.createElement("th"); th.textContent=t; headerRow.appendChild(th); });
  thead.appendChild(headerRow); table.appendChild(thead);

  const tbody=document.createElement("tbody");
  (level.items||[]).forEach(it=>{
    const tr=document.createElement("tr");
    [it.q, Array.isArray(it.a)?it.a.join(", "):it.a].forEach(val=>{
      const td=document.createElement("td"); td.textContent=val||""; tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); studyDiv.appendChild(table);
}

//CREAR URL DE PRACTICA
document.querySelector("#practiceButton").onclick = () => {
  if (!selected) return;
  location.href = `practiceGround.html?play=${encodeURIComponent(selected.dataset.listName)}&level=${encodeURIComponent(selected.dataset.index)}`;
};

function showGanbatte(){ if(!studyDiv.innerHTML.trim()) studyDiv.innerHTML="<h1 class='title'>„Åå„Çì„Å∞„Å£„Å¶</h1><h3 style='font-weight:bold;padding-left:10px;margin-top:0px'>√Ånimo</h3>"; }

initSectionsOnly();
showGanbatte();
</script>
</body>
</html>